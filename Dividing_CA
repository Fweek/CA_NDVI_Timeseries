import ee, os, csv
ee.Initialize()

#Set working directory
os.chdir('C:\Users\Michael\Desktop\CA_Divided')

#Import feature collection
fields = ee.FeatureCollection("ft:1GE0weDX4hKp_8Lt-MRySeDktJJ-gej7czjWPmzAx")

#Coordinates for California box
North = 42.02 #northern-most point in CA
South = 32.40 #southern-most point in CA
West = -124.453125 #western-most point in CA
East = -114.0985107421875 #eastern-most point in CA

#Calculate the distance between North and South points
difference = (North-South)

#How many sections should CA be divided into?
divided = 10 #we picked arbitrarily ten

#Calculate how big each split should be
splitsize = difference/divided

#Create coordinates for each split and add an ID column
coordinates = []

for count in range(divided):
    coordinates.append([West, South+(splitsize*(count+1)), East, South+(splitsize*(count))])

print coordinates

#Count the number of fields in each split
FinalFeatures = []
FinalCoordinates = []
for i in range(divided):
    Coord = coordinates[(i)]
    Box = ee.Geometry.Rectangle(Coord)
    Box_fields = fields.filterBounds(Box)
    print('Counting...')
    numFields = Box_fields.size().getInfo() #this part takes awhile
    maxFields = 15000
    if numFields > maxFields:
        nWest = Coord[0]
        nNorth = Coord[1]
        nEast = Coord[2]
        nSouth = Coord[3]
        nDifference = nNorth-nSouth
        nDivided = maxFields/numFields
        nSplitsize = nDifference/nDivided
        nCoordinates = []
        for nCount in range(nDivided):
            nCoordinates.append([nWest, nSouth+(nSplitsize*(nCount+1)), nEast, nSouth+(nSplitsize*(nCount))])
        nNumFeatures = []
        for k in range(nDivided):
            nCoord = nCoordinates[(i)]
            nBox = ee.Geometry.Rectangle(nCoord)
            nBox_fields = fields.filterBounds(nBox)
            print('Recounting...')
            nNumFeatures.append(nBox_fields.size().getInfo())  # this part takes awhile
        FinalCoordinates.append(nCoordinates)
        FinalFeatures.append(nNumFeatures)
    else:
        FinalFeatures.append(numFields)
        FinalCoordinates.append(Coord)

print FinalFeatures
print FinalCoordinates
